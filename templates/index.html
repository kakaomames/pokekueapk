<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Gemini programmingéšŠã«ã‚ˆã‚‹Android on Webã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã€‚Docker, Flask, Renderã‚’ä½¿ç”¨ã€‚">
    <meta name="keywords" content="Android, Emulator, Docker, Flask, VNC, WebSockets, Render, Gemini, apks, ã‚«ã‚«ã‚ªãƒãƒ¡">
    <meta name="author" content="ã‚«ã‚«ã‚ªãƒãƒ¡">
    <title>GeminiéšŠ Android Emulator (Render)</title>
    <link rel="icon" type="image/png" href="https://kakaomames.github.io/rei/logo.png">
    <style>
        body { margin: 0; overflow: hidden; background-color: #222; color: white; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; font-family: sans-serif; }
        #vnc_screen { width: 100%; height: 100%; }
        /* noVNCã®è¦ç´ ã‚’ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã«ã™ã‚‹ãŸã‚ã®èª¿æ•´ */
        .noVNC_viewport { width: 100vw !important; height: 100vh !important; }
        .VNC_canvas { width: 100% !important; height: 100% !important; }
        .loading-text { font-size: 1.5rem; color: #4CAF50; }
    </style>
</head>
<body>
    <div id="vnc_screen">
        <canvas id="noVNC_canvas" style="display: none;"></canvas>
        <div id="loading" class="loading-text">
            ğŸš€ Androidã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚’èµ·å‹•ä¸­... (ç´„30ç§’)
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/@novnc/novnc@1.3.0/core/util.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@novnc/novnc@1.3.0/core/webutil.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@novnc/novnc@1.3.0/core/rfb.js"></script>

    <script>
        const host = window.location.hostname;
        // Flaskã‹ã‚‰æ¸¡ã•ã‚ŒãŸãƒ‘ã‚¹ã‚’ä½¿ç”¨
        const path = "{{ path }}"; 
        
        // Renderã§ã¯ã€WebSocketæ¥ç¶šã¯æ¨™æº–ãƒãƒ¼ãƒˆ80ã§ç¢ºç«‹ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ãŒã€
        // Renderã®Web Serviceã¯8080ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
        // RenderãŒè‡ªå‹•çš„ã«ãƒãƒ¼ãƒˆå¤‰æ›ã—ã¦ãã‚Œã‚‹ã“ã¨ã‚’æœŸå¾…ã—ã€ç›¸å¯¾ãƒ‘ã‚¹ã§æ¥ç¶šã—ã¾ã™ã€‚
        
        // ãƒ—ãƒ­ã‚­ã‚·ã¸ã®æ¥ç¶šURLã‚’æ§‹ç¯‰: ws://<Renderãƒ›ã‚¹ãƒˆ>/websockify
        let url = 'ws://' + host + '/' + path;

        // RenderãŒHTTPSã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆ
        if (window.location.protocol === "https:") {
            url = 'wss://' + host + '/' + path;
        }

        const rfb = new RFB(
            document.getElementById('noVNC_canvas'), 
            url, 
            {
                wsProtocols: ['binary'], // VNCãƒ—ãƒ­ãƒˆã‚³ãƒ«ã¯ãƒã‚¤ãƒŠãƒªé€šä¿¡
            }
        );

        rfb.addEventListener('connect', () => {
            console.log("VNC connected!");
            document.getElementById('loading').style.display = 'none';
            document.getElementById('noVNC_canvas').style.display = 'block';
        });

        rfb.addEventListener('disconnect', (e) => {
            console.log("VNC disconnected: " + e.detail.reason);
            document.getElementById('loading').innerHTML = `ğŸš¨ æ¥ç¶šãŒåˆ‡ã‚Œã¾ã—ãŸ: ${e.detail.reason}<br>ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚`;
            document.getElementById('loading').style.display = 'block';
            document.getElementById('noVNC_canvas').style.display = 'none';
        });
        
        // æ¥ç¶šã‚’é–‹å§‹
        rfb.connect();

    </script>
</body>
</html>
